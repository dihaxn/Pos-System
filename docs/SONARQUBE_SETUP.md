# SonarQube Setup Guide

This document explains how to configure SonarQube analysis for the LLOMS POS System.

## Overview

The project includes automated code quality analysis using SonarQube. The configuration supports:

- **Java microservices** in the `services/` directory
- **Node.js applications** in `frontend/` and `bff/` directories
- **Multi-language analysis** (Java, JavaScript, TypeScript)

## Required Secrets

To enable SonarQube analysis, configure these repository secrets in GitHub:

### 1. SONAR_TOKEN
- Generate a token in your SonarQube instance:
  - Log into SonarQube
  - Go to **My Account** → **Security** → **Generate Tokens**
  - Create a token with analysis permissions
- Add this token to GitHub repository secrets as `SONAR_TOKEN`

### 2. SONAR_HOST_URL
- The URL of your SonarQube instance (e.g., `https://sonarqube.company.com`)
- Add this URL to GitHub repository secrets as `SONAR_HOST_URL`

## Project Configuration

The project uses `sonar-project.properties` for configuration:

```properties
sonar.projectKey=dihaxn_Pos-System
sonar.projectName=LLOMS POS System
sonar.sources=services,frontend,bff
sonar.tests=services/*/src/test,frontend/*/src/__tests__,bff/test
```

## Setting Up GitHub Repository Secrets

1. Go to your repository on GitHub
2. Navigate to **Settings** → **Secrets and variables** → **Actions**
3. Click **New repository secret**
4. Add each required secret:
   - Name: `SONAR_TOKEN`, Value: `your-sonarqube-token`
   - Name: `SONAR_HOST_URL`, Value: `your-sonarqube-url`

## SonarQube Project Setup

1. **Create Project in SonarQube:**
   - Log into your SonarQube instance
   - Click **Create project**
   - Choose **GitHub** as the source
   - Select this repository
   - Use project key: `dihaxn_Pos-System`

2. **Configure Analysis:**
   - The workflow will automatically run on:
     - Push to `main` branch
     - Pull requests to `main` branch
     - Manual workflow dispatch

## Troubleshooting

### Common Issues

1. **"SONAR_TOKEN env variable required"**
   - Ensure the `SONAR_TOKEN` secret is set in repository settings
   - Verify the token has analysis permissions in SonarQube

2. **"Project not found"**
   - Check that the project exists in SonarQube
   - Verify the `sonar.projectKey` matches the project key in SonarQube

3. **Analysis fails for specific languages**
   - Ensure the SonarQube instance has the required language plugins
   - Check that source paths are correctly configured

### Disabling SonarQube Analysis

If you need to temporarily disable SonarQube analysis:

1. Comment out or delete the workflow trigger events in `.github/workflows/sonarqube.yml`
2. Or remove the workflow file entirely

## Coverage Reports

The configuration expects coverage reports in these locations:
- **Java**: Generated by Maven Surefire plugin in `target/site/jacoco/`
- **JavaScript/TypeScript**: Generated by Jest in `coverage/lcov.info`

Ensure your build processes generate coverage reports for accurate analysis.